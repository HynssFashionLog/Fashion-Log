<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>자유 게시글 상세보기</title>
  <link rel="stylesheet" th:href="@{/css/style.css}"/>
</head>
<body>
<!-- 글 상세 보기 -->
<h1>제목</h1>
<div class="post-detail" th:if="${postExists}">
  <h2 th:text="${post.title}">Title</h2>
  <p class="post-meta">
    작성자: <span>Member</span>
    작성일: <span th:text="${post.createdAt}">CreatedAt</span>
  </p>
  <div class="post-content" th:text="${post.content}">Content</div>
  <div class="post-actions">
    <a th:href="@{/fashionlog/freeboard}">목록으로</a>
    <a th:href="@{/fashionlog/freeboard/{id}/edit(id=${post.id})}" class="edit-btn">수정</a>
    <form th:action="@{/fashionlog/freeboard/{id}/delete(id=${post.id})}" method="post"
          class="delete-form">
      <button type="submit">삭제</button>
    </form>
  </div>
</div>
<!-- 댓글 작성 -->
<h3>댓글 작성</h3>
<form th:action="@{/fashionlog/freeboard/{id}/comment(id=${post.id})}" method="post">
  <div>
    <label for="content">내용</label>
    <textarea id="content" name="content"></textarea>
  </div>
  <button type="submit">작성 완료</button>
</form>
<!-- 댓글 목록 -->
<div class="post-comments">
  <table>
    <thead>
    <tr>
      <th>작성자</th>
      <th>내용</th>
      <th>작성일</th>
      <th>수정 버튼</th>
      <th>삭제 버튼</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="comment : ${comments}">
      <td>작성자</td>
      <td th:text="${comment.content}"></td>
      <td th:text="${comment.createdAt}"></td>
      <td>
        <button type="button" th:onclick="'showEditForm(' + ${comment.id} + ')'"
                th:id="'edit-btn-' + ${comment.id}">Edit
        </button>
      </td>
      <td>
        <form th:action="@{/fashionlog/freeboard/{postId}/delete-comment/{commentId}(postId=${post.id}, commentId=${comment.id})}"
              method="post">
          <button type="submit">Delete</button>
        </form>
      </td>
    </tr>
    <tr th:each="comment : ${comments}" th:attr="id=${'edit-form-' + comment.id}"
        style="display:none;">
      <td colspan="5">
        <form
            th:action="@{/fashionlog/freeboard/{postId}/edit-comment/{commentId}(postId=${post.id}, commentId=${comment.id})}"
            method="post">
          <textarea name="content" required th:text="${comment.content}"></textarea>
          <button type="submit">Save</button>
          <button type="button" th:onclick="'hideEditForm(' + ${comment.id} + ')'">Cancel</button>
        </form>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- 수정 폼 띄우기 스크립트 임시 -->
<script th:inline="javascript">
  function showEditForm(commentId) {
    // 모든 기존의 수정 폼을 숨김
    hideEditForm();

    // 댓글 행 찾기
    const commentRow = document.querySelector(`#edit-btn-${commentId}`).closest('tr');
    if (!commentRow) {
      return;
    }

    // 수정 폼 행 찾기
    const editFormRow = document.getElementById(`edit-form-${commentId}`);
    if (!editFormRow) {
      return;
    }

    // 수정 폼을 댓글 행 다음에 추가
    commentRow.insertAdjacentElement('afterend', editFormRow);
    editFormRow.style.display = 'table-row';
  }

  function hideEditForm() {
    // 모든 수정 폼 행 숨기기
    document.querySelectorAll('[id^="edit-form-"]').forEach(form => {
      form.style.display = 'none';
    });
  }
</script>
</body>
</html>